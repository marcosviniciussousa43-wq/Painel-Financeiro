<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Painel Financeiro</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f4f7f6;
            color: #333;
        }
        main {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1 { color: #007bff; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 5px; }
        form { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        div { margin-bottom: 1rem; }
        label { display: block; font-weight: 600; margin-bottom: 5px; }
        input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box; /* Garante que o padding n√£o quebre o layout */
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            grid-column: 1 / -1; /* Ocupa as duas colunas */
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover { background-color: #0056b3; }
        #resultado-container {
            margin-top: 2rem;
            background-color: #f9f9f9;
            padding: 1rem;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        th { background-color: #f0f0f0; }
        .loading { font-style: italic; color: #555; }
        .error { color: #D8000C; background-color: #FFD2D2; padding: 1rem; border-radius: 4px; }
    </style>
</head>
<body>

    <main>
        <h1>üöÄ Meu Painel Financeiro</h1>
        <p>Bem-vindo √† sua plataforma de proje√ß√£o de metas!</p>

        <h2>Calculadora de Proje√ß√£o</h2>
        <form id="projecao-form">
            <div>
                <label for="valor_inicial">Valor Inicial (R$)</label>
                <input type="number" id="valor_inicial" value="7000" required>
            </div>
            <div>
                <label for="aporte_mensal">Aporte Mensal (R$)</label>
                <input type="number" id="aporte_mensal" value="800" required>
            </div>
            <div>
                <label for="meses_sem_aporte">Meses por Ano SEM Aporte</label>
                <input type="number" id="meses_sem_aporte" value="0" required>
            </div>
            <div>
                <label for="meta_financeira">Meta Financeira (R$)</label>
                <input type="number" id="meta_financeira" value="1000000" required>
            </div>
            <button type="submit" id="calcular-btn">Calcular Proje√ß√£o</button>
        </form>

        <div id="resultado-container">
            <p>Preencha os dados e clique em "Calcular" para ver sua proje√ß√£o.</p>
        </div>
    </main>

    <script>
        // Este √© o "c√©rebro" que conecta o HTML com a sua API FastAPI
        
// Espera a p√°gina carregar completamente
document.addEventListener("DOMContentLoaded", () => {
    
    // "Pega" os elementos do HTML que vamos usar
    const form = document.getElementById("projecao-form");
    const resultadoContainer = document.getElementById("resultado-container");

    // "Ouve" quando o usu√°rio clicar no bot√£o "submit" (Calcular)
    form.addEventListener("submit", async (event) => {
        
        // 1. Previne o formul√°rio de recarregar a p√°gina (comportamento padr√£o)
        event.preventDefault(); 
        
        // 2. Mostra uma mensagem de "Carregando"
        resultadoContainer.innerHTML = '<p class="loading">Calculando sua proje√ß√£o...</p>';

        // 3. Pega os valores dos campos <input> e converte para n√∫meros
        const requestData = {
            valor_inicial: parseFloat(document.getElementById("valor_inicial").value),
            aporte_mensal: parseFloat(document.getElementById("aporte_mensal").value),
            meses_por_ano_sem_aporte: parseInt(document.getElementById("meses_sem_aporte").value),
            meta_financeira: parseFloat(document.getElementById("meta_financeira").value)
        };

        try {
            // 4. CHAMA A SUA API! (O Pulo do Gato)
            const response = await fetch("/projetar-meta", {
                method: "POST", // Usa o m√©todo POST (como definimos no FastAPI)
                headers: {
                    "Content-Type": "application/json" // Avisa que estamos enviando JSON
                },
                body: JSON.stringify(requestData) // Converte nosso objeto JS em texto JSON
            });

            // 5. Se a API retornar um erro (ex: 500, 400), mostra o erro
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.detail || "Erro desconhecido no servidor.");
            }

            // 6. Se deu tudo certo, pega a resposta da API
            const data = await response.json();

            // 7. Chama a fun√ß√£o para "desenhar" o resultado na tela
            displayResults(data);

        } catch (error) {
            // 8. Se a rede falhar ou a API der erro, mostra aqui
            resultadoContainer.innerHTML = `<p class="error"><strong>Erro:</strong> ${error.message}</p>`;
        }
    }); // <--- Fim do form.addEventListener

    // Fun√ß√£o que "desenha" o HTML do resultado
    // (Esta √© a fun√ß√£o que atualizamos para incluir a l√≥gica de imposto)
    function displayResults(data) {
        // Cria o HTML do resumo
        let html = `
            <h2>Resultados da Proje√ß√£o</h2>
            <p>
                Voc√™ atingir√° sua meta de <strong>R$ ${data.valor_final_atingido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong>
                em <strong>${data.meses_para_atingir_meta} meses</strong> 
                (ou ${data.anos_para_atingir_meta} anos).
            </p>
            
            <p style="font-size: 0.9em; color: #555; margin-top: -10px;">
                (Proje√ß√£o calculada usando rentabilidade real <strong>l√≠quida</strong>, 
                considerando 15% de IR sobre o ganho nominal.)
            </p>
            
            <h3>Resumo Ano a Ano</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ano</th>
                        <th>Valor Inicial</th>
                        <th>Aportes no Ano</th>
                        <th>Juros L√≠quidos no Ano</th> <th>Valor Final</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        // Cria uma linha <tr> para cada item do "resumo_anual"
        data.resumo_anual.forEach(ano => {
            html += `
                <tr>
                    <td>${ano.ano}</td>
                    <td>${ano.valor_inicio_ano.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                    <td>${ano.aportes_no_ano.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                    <td>${ano.juros_ganhos_no_ano.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                    <td>${ano.valor_final_ano.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                </tr>
            `;
        });

        html += `
                </tbody>
            </table>
        `;

        // Coloca o HTML final dentro da div "resultado-container"
        resultadoContainer.innerHTML = html;
    } // <--- Fim da fun√ß√£o displayResults

}); // <--- Fim do document.addEventListener
    </script>
</body>
</html>